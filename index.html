<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üéâ Extravagant Puzzle</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    color: #222;
    margin: 0;
    overflow: hidden;
  }
  .card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    padding: 25px 30px;
    max-width: 500px;
    text-align: center;
  }
  h1 {
    font-size: 2rem;
    margin-bottom: 10px;
  }
  h2 {
    margin: 15px 0;
  }
  #mathHud {
    font-weight: bold;
    color: #4f46e5;
    margin-bottom: 8px;
  }
  input {
    font-size: 1rem;
    padding: 10px;
    width: 80%;
    margin: 10px 0;
    border: 2px solid #ddd;
    border-radius: 8px;
  }
  button {
    background: #6366f1;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 1rem;
    cursor: pointer;
  }
  button:hover {
    background: #4f46e5;
  }
  .hidden { display: none; }
  .msg { font-weight: bold; margin-top: 10px; }
  .cube {
    width: 50px;
    height: 50px;
    background: #e5e7eb;
    border-radius: 8px;
    transition: background 0.3s;
  }
  #flashGrid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
  }
  .flashBtn {
    font-size: 2rem;
    width: 60px;
    height: 60px;
    border-radius: 10px;
    background: #f3f4f6;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
  }
  .highlight {
    background: #c7d2fe !important;
    transition: 0.3s;
  }
</style>
</head>
<body>
<div class="card">
  <h1>üß© Extravagant Puzzle</h1>

  <!-- Puzzle 1 -->
  <section id="S1">
    <h2>Puzzle 1 ‚Äì Solve the Math</h2>
    <div id="mathHud">Question 1 of 10</div>
    <p id="mathQ">What is ?</p>
    <input id="mathA" placeholder="Your answer" />
    <button id="mathSubmit">Submit</button>
    <p id="mathMsg"></p>
  </section>

  <!-- Puzzle 2 -->
  <section id="S2" class="hidden">
    <h2>Puzzle 2 ‚Äì Emoji Sequence</h2>
    <p>Enter the correct 3 emojis in order üß†</p>
    <input id="emojiInput" placeholder="e.g. üçéüçåüçá" />
    <button id="emojiSubmit">Submit</button>
    <p id="emojiMsg"></p>
  </section>

  <!-- Puzzle 3 -->
  <section id="S3" class="hidden">
    <h2>Puzzle 3 ‚Äì Drag Through All Cubes</h2>
    <p>Drag across every cube before the timer ends!</p>
    <div id="dragGrid"
         style="display:grid;grid-template-columns:repeat(6,50px);gap:10px;justify-content:center;margin-top:10px;">
    </div>
    <div id="dragBar"
         style="height:10px;background:linear-gradient(90deg,#3b82f6,#60a5fa);border-radius:5px;margin-top:20px;width:0%;">
    </div>
    <button id="dragRestart" class="hidden">Restart</button>
  </section>

  <!-- Puzzle 4 -->
  <section id="S4" class="hidden">
    <h2>Puzzle 4 ‚Äì Memory Flash</h2>
    <p id="flashRound">Round 1 of 5</p>
    <div id="flashGrid"></div>
    <p id="flashMsg"></p>
    <button id="flashStart">Start Sequence</button>
  </section>

  <!-- End -->
  <section id="End" class="hidden">
    <h2>üéâ Congratulations!</h2>
    <p id="scoreText"></p>
    <button onclick="location.reload()">Play Again</button>
  </section>
</div>

<script>
const S1=document.getElementById('S1'),
      S2=document.getElementById('S2'),
      S3=document.getElementById('S3'),
      S4=document.getElementById('S4'),
      End=document.getElementById('End');

function show(section){[S1,S2,S3,S4,End].forEach(x=>x.classList.add('hidden'));section.classList.remove('hidden');}

/* ---------- PUZZLE 1 (HUD ENABLED) ---------- */
let mathScore=0,mathCount=0;
const mathQ=document.getElementById('mathQ');
const mathA=document.getElementById('mathA');
const mathMsg=document.getElementById('mathMsg');
const mathHud=document.getElementById('mathHud');

function updateMathHud(){mathHud.textContent=`Question ${mathCount+1} of 10`; }

function newMath(){
  if(mathCount>=10){show(S2);return;}
  const a=Math.floor(Math.random()*10)+1;
  const b=Math.floor(Math.random()*10)+1;
  mathQ.textContent=`What is ${a} + ${b}?`;
  mathQ.dataset.answer=a+b;
  updateMathHud();
}

document.getElementById('mathSubmit').onclick=()=>{
  const ans=parseInt(mathA.value);
  if(ans==mathQ.dataset.answer){mathScore++;mathMsg.textContent='‚úÖ Correct!';}
  else{mathMsg.textContent='‚ùå Wrong!';}
  mathCount++;
  setTimeout(()=>{mathMsg.textContent='';newMath();},600);
};

newMath();

/* ---------- PUZZLE 2 ---------- */
const emojiSeq='üçéüçåüçá';
document.getElementById('emojiSubmit').onclick=()=>{
  const v=document.getElementById('emojiInput').value.trim();
  if(v===emojiSeq){show(S3);initDragPuzzle();}
  else{document.getElementById('emojiMsg').textContent='‚ùå Wrong!';}
};

/* ---------- PUZZLE 3 (Touch Optimized) ---------- */
function initDragPuzzle(){
  const grid=document.getElementById('dragGrid');
  grid.innerHTML='';
  const cubes=[];
  for(let i=0;i<30;i++){
    const c=document.createElement('div');
    c.className='cube';
    grid.appendChild(c);
    cubes.push(c);
  }

  let dragging=false;
  let done=0;
  const bar=document.getElementById('dragBar');
  const restartBtn=document.getElementById('dragRestart');

  grid.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});

  function activateCube(c){
    if(!c.classList.contains('active')){
      c.classList.add('active');
      c.style.background='#6366f1';
      done++;
      if(done>=cubes.length){
        show(S4);
        initMemoryFlash();
      }
    }
  }

  grid.onmousedown=()=>dragging=true;
  grid.onmouseup=()=>dragging=false;
  grid.onmouseleave=()=>dragging=false;
  cubes.forEach(c=>{c.onmouseover=()=>{if(dragging)activateCube(c);};});

  grid.ontouchstart=e=>{
    dragging=true;
    const t=e.touches[0];
    const el=document.elementFromPoint(t.clientX,t.clientY);
    if(el&&el.classList.contains('cube'))activateCube(el);
  };
  grid.ontouchmove=e=>{
    const t=e.touches[0];
    const el=document.elementFromPoint(t.clientX,t.clientY);
    if(el&&el.classList.contains('cube'))activateCube(el);
  };
  grid.ontouchend=()=>dragging=false;

  let time=0;
  const interval=setInterval(()=>{
    time+=1;
    if(time<=100){bar.style.width=time+'%';}
    else{clearInterval(interval);restartBtn.classList.remove('hidden');}
  },100);

  restartBtn.onclick=()=>{show(S3);initDragPuzzle();};
}

/* ---------- PUZZLE 4 (MULTI-ROUND MEMORY FLASH) ---------- */
const flashGrid=document.getElementById('flashGrid');
const flashMsg=document.getElementById('flashMsg');
const flashStart=document.getElementById('flashStart');
const flashRound=document.getElementById('flashRound');
let flashSequence=[];
let userSequence=[];
let flashScore=0;
let round=1;
const totalRounds=5;

const emojis=['üçé','üî•','üê∏','‚≠ê','üíß','üê±','üé≤','üçì'];

function initMemoryFlash(){
  flashGrid.innerHTML='';
  flashMsg.textContent='';
  userSequence=[];
  flashSequence=[];
  flashRound.textContent=`Round ${round} of ${totalRounds}`;
  flashStart.classList.remove('hidden');
  emojis.forEach(e=>{
    const b=document.createElement('div');
    b.className='flashBtn';
    b.textContent=e;
    b.onclick=()=>userPick(e);
    flashGrid.appendChild(b);
  });
}

flashStart.onclick=()=>{
  flashStart.classList.add('hidden');
  flashMsg.textContent='üëÄ Watch carefully...';
  flashSequence=[];
  for(let i=0;i<round+2;i++){flashSequence.push(emojis[Math.floor(Math.random()*emojis.length)]);}
  let i=0;
  const interval=setInterval(()=>{
    highlightEmoji(flashSequence[i]);
    i++;
    if(i>=flashSequence.length){
      clearInterval(interval);
      setTimeout(()=>{flashMsg.textContent='Now repeat the sequence!';},500);
    }
  },800);
};

function highlightEmoji(e){
  const btns=[...document.getElementsByClassName('flashBtn')];
  const btn=btns.find(b=>b.textContent===e);
  if(btn){
    btn.classList.add('highlight');
    setTimeout(()=>btn.classList.remove('highlight'),400);
  }
}

function userPick(e){
  if(flashStart.classList.contains('hidden')){
    userSequence.push(e);
    if(userSequence.length===flashSequence.length){
      if(JSON.stringify(userSequence)===JSON.stringify(flashSequence)){
        flashScore++;
        flashMsg.textContent='‚úÖ Correct!';
        if(round<totalRounds){
          round++;
          setTimeout(()=>initMemoryFlash(),1000);
        } else {
          setTimeout(()=>{show(End);finalScore();},1000);
        }
      } else {
        flashMsg.textContent='‚ùå Wrong!';
        setTimeout(()=>{show(End);finalScore();},1000);
      }
    }
  }
}

/* ---------- END ---------- */
function finalScore(){
  document.getElementById('scoreText').textContent=
    `Math Score: ${mathScore}/10\nMemory Score: ${flashScore}/${totalRounds}`;
}
</script>
</body>
</html>